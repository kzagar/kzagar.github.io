(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))r(a);new MutationObserver(a=>{for(const o of a)if(o.type==="childList")for(const d of o.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&r(d)}).observe(document,{childList:!0,subtree:!0});function s(a){const o={};return a.integrity&&(o.integrity=a.integrity),a.referrerPolicy&&(o.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?o.credentials="include":a.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(a){if(a.ep)return;a.ep=!0;const o=s(a);fetch(a.href,o)}})();class w{constructor(e,s){this.start=e,this.end=s}static fromJSON(e){return new w(new Date(e.start),new Date(e.end))}toJSON(){return{start:this.start.toISOString(),end:this.end.toISOString()}}getDuration(){return(this.end.getTime()-this.start.getTime())/1e3}}class N{constructor(e,s=new Date().toISOString()){this.content=e,this.time=s}static fromJSON(e){return new N(e.content,e.time)}toJSON(){return{content:this.content,time:this.time}}}class D{constructor(e,s,r=0,a=[],o=[]){this.id=e,this.name=s,this.time=r,this.journals=a.map(d=>N.fromJSON(d)),this.intervals=o.map(d=>w.fromJSON(d)),this.totalIntervalTime=this.calculateTotalIntervalTime()}updateName(e){this.name=e}addJournal(e){const s=new N(e);return this.journals.push(s),s}addInterval(e,s){const r=new w(e,s);return this.intervals.push(r),this.totalIntervalTime+=r.getDuration(),r}updateInterval(e,s,r){if(e>=0&&e<this.intervals.length){const a=this.intervals[e];this.totalIntervalTime-=a.getDuration();const o=new w(s,r);return this.intervals[e]=o,this.totalIntervalTime+=o.getDuration(),!0}return!1}getIntervals(){return this.intervals}calculateTotalIntervalTime(){let e=0;return this.intervals.forEach(s=>{e+=s.getDuration()}),Math.floor(e)}static fromJSON(e){const s=new D(e.id,e.name,e.time,e.journals,e.intervals);return s.totalIntervalTime=s.calculateTotalIntervalTime(),s}toJSON(){return{id:this.id,name:this.name,time:this.time,journals:this.journals.map(e=>e.toJSON()),intervals:this.intervals.map(e=>e.toJSON())}}}class E{constructor(e=[],s=1){this.tasks=e.map(r=>D.fromJSON(r)),this.nextTaskId=s}addTask(e){const s=new D(this.nextTaskId++,e.trim());return this.tasks.unshift(s),s}deleteTask(e){return this.tasks.find(r=>r.id===e)?(this.tasks=this.tasks.filter(r=>r.id!==e),!0):!1}findTask(e){return this.tasks.find(s=>s.id===e)}updateTaskName(e,s){const r=this.findTask(e);return r?(r.updateName(s),!0):!1}addJournalEntry(e,s){const r=this.findTask(e);return r?(r.addJournal(s),!0):!1}getAllTasks(){return this.tasks}toJSON(){return{tasks:this.tasks.map(e=>e.toJSON()),nextTaskId:this.nextTaskId}}static fromJSON(e){return new E(e.tasks,e.nextTaskId)}}document.addEventListener("DOMContentLoaded",()=>{const m=document.querySelector("#task-table tbody"),e=document.querySelector("#task-row-template"),s=document.querySelector("#new-task-row .new-task-input");let r=new E,a=-1,o=null,d=null,f=[],S=null,T=[],g=null;function L(t){const n=Math.floor(t/3600),l=Math.floor(t%3600/60),i=t%60,c=u=>u.toString().padStart(2,"0");return n>0?`${n}:${c(l)}:${c(i)}`:`${l}:${c(i)}`}function q(){const t=localStorage.getItem("chronosTasks"),n=localStorage.getItem("chronosTaskOrder"),l=localStorage.getItem("chronosRunningTaskId"),i=localStorage.getItem("chronosRunningTaskStartTime"),c=localStorage.getItem("chronosTasksWithVisibleJournals");if(t?r=E.fromJSON(JSON.parse(t)):(r=new E,r.addTask("Task 1"),r.addTask("Task 2"),r.addTask("Task 3")),n?f=JSON.parse(n):f=r.getAllTasks().map(u=>u.id),l!==null){a=parseInt(l,10);const u=r.findTask(a);if(u){if(i){const k=new Date(i),p=(new Date().getTime()-k.getTime())/1e3;u.totalIntervalTime+=p}o=new Date,d=setInterval(()=>{const k=o?(new Date().getTime()-o.getTime())/1e3:0,p=u.totalIntervalTime+k,y=document.querySelector(`tr[data-id='${u.id}'] .task-time`);y&&(y.textContent=L(Math.floor(p))),h()},1e3)}else a=-1,o=null}c&&(T=JSON.parse(c))}function h(){localStorage.setItem("chronosTasks",JSON.stringify(r)),localStorage.setItem("chronosTaskOrder",JSON.stringify(f)),localStorage.setItem("chronosRunningTaskId",a.toString()),localStorage.setItem("chronosTasksWithVisibleJournals",JSON.stringify(T))}function I(){const t=document.getElementById("new-task-row");Array.from(m.children).forEach(n=>{n.id!=="new-task-row"&&n.remove()}),m.firstChild!==t&&t&&m.prepend(t);for(let n=f.length-1;n>=0;n--){const l=f[n],i=r.findTask(l);if(!i)continue;const c=e.content.cloneNode(!0),u=c.querySelector("tr");u.dataset.id=i.id.toString();const k=c.querySelector(".task-name");k.textContent=i.name,k.contentEditable="true",k.dataset.taskId=i.id.toString();const p=c.querySelector(".task-time"),y=i.totalIntervalTime+(i.id===a&&o?(new Date().getTime()-o.getTime())/1e3:0);p.textContent=L(Math.floor(y));const v=c.querySelector(".start-pause-btn");v.textContent=i.id===a?"❚❚":"▶";const O=c.querySelector(".show-journal-checkbox");O.checked=T.includes(i.id),O.dataset.taskId=i.id.toString(),t&&m.insertBefore(c,t.nextSibling)}}function B(t){const n=r.findTask(t);if(n){if(a===t)d&&(clearInterval(d),d=null),o&&(n.addInterval(o,new Date),o=null,localStorage.setItem("chronosRunningTaskStartTime","")),a=-1;else{if(a!==-1){const l=r.findTask(a);l&&d&&(clearInterval(d),d=null,o&&l.addInterval(o,new Date))}a=t,o=new Date,localStorage.setItem("chronosRunningTaskStartTime",o.toISOString()),d=setInterval(()=>{const l=o?(new Date().getTime()-o.getTime())/1e3:0,i=n.totalIntervalTime+l,c=document.querySelector(`tr[data-id='${n.id}'] .task-time`);c&&(c.textContent=L(Math.floor(i))),h()},1e3)}h(),I()}}function R(t,n){r.updateTaskName(t,n)&&h()}function M(t){if(t.trim()==="")return;const n=r.addTask(t);f.unshift(n.id),h(),I(),s.textContent=""}function $(t){const n=r.findTask(t);n&&confirm(`Are you sure you want to delete "${n.name}"?`)&&r.deleteTask(t)&&(f=f.filter(l=>l!==t),a===t&&(d&&(clearInterval(d),d=null),o=null,a=-1,localStorage.setItem("chronosRunningTaskStartTime","")),T=T.filter(l=>l!==t),h(),I(),b())}m.addEventListener("click",t=>{const n=t.target,l=n.closest("tr");if(!l)return;const i=parseInt(l.dataset.id,10);n.classList.contains("start-pause-btn")?B(i):n.classList.contains("journal-btn")?(S=i,P()):n.classList.contains("delete-btn")?$(i):n.classList.contains("show-journal-checkbox")&&(n.checked?T.includes(i)||T.push(i):T=T.filter(c=>c!==i),h(),b())}),m.addEventListener("keydown",t=>{if(t.target.classList.contains("task-name")){if(t.key==="Enter")t.preventDefault(),t.target.blur();else if(t.key==="Escape"){const n=r.findTask(parseInt(t.target.dataset.taskId));n&&(t.target.textContent=n.name),t.target.blur()}}else t.target.classList.contains("new-task-input")&&t.key==="Enter"&&(t.preventDefault(),M(t.target.textContent||""))}),m.addEventListener("blur",t=>{if(t.target.classList.contains("task-name")){const n=parseInt(t.target.dataset.taskId,10),l=(t.target.textContent||"").trim();R(n,l)}},!0),m.addEventListener("dragstart",t=>{t.target.tagName==="TR"&&t.target.id!=="new-task-row"&&(g=t.target,t.dataTransfer.effectAllowed="move",setTimeout(()=>{g&&(g.style.opacity="0.5")},0))}),m.addEventListener("dragover",t=>{if(t.preventDefault(),t.target&&t.target.closest("tr")&&t.target.closest("tr").id!=="new-task-row"&&g){const n=t.target.closest("tr");if(n!==g){const l=n.getBoundingClientRect(),i=l.y+l.height/2;t.clientY>i?(n.style.borderBottom="2px solid blue",n.style.borderTop=""):(n.style.borderTop="2px solid blue",n.style.borderBottom="")}}}),m.addEventListener("dragleave",t=>{t.target&&t.target.closest("tr")&&(t.target.closest("tr").style.borderTop="",t.target.closest("tr").style.borderBottom="")}),m.addEventListener("drop",t=>{if(t.preventDefault(),t.target&&t.target.closest("tr")&&t.target.closest("tr").id!=="new-task-row"&&g){const n=t.target.closest("tr"),l=parseInt(n.dataset.id,10),i=parseInt(g.dataset.id,10),c=f.indexOf(i),u=f.indexOf(l);c!==-1&&u!==-1&&(f.splice(c,1),f.splice(u,0,i),h()),I()}g&&(g.style.opacity=""),t.target&&t.target.closest("tr")&&(t.target.closest("tr").style.borderTop="",t.target.closest("tr").style.borderBottom="")}),m.addEventListener("dragend",t=>{g&&(g.style.opacity=""),m.querySelectorAll("tr").forEach(n=>{n.style.borderTop="",n.style.borderBottom=""}),g=null}),"serviceWorker"in navigator&&window.addEventListener("load",()=>{navigator.serviceWorker.register("sw.js").then(t=>{console.log("Service Worker registered: ",t)}).catch(t=>{console.log("Service Worker registration failed: ",t)})});const C=document.getElementById("journal-dialog"),J=document.getElementById("journal-input"),A=document.getElementById("add-journal-btn"),W=document.getElementById("discard-journal-btn");function P(){C.style.display="flex",J.value="",J.focus()}function x(){C.style.display="none",J.value="",S=null}function j(){const t=J.value.trim();if(t===""){alert("Journal entry cannot be empty.");return}if(S===null){alert("No task selected for journal entry.");return}if(r.addJournalEntry(S,t)){h(),x();const n=r.findTask(S);console.log("Journal Entries for Task:",n?n.journals:"Task not found"),b()}else alert("Selected task not found.")}A.addEventListener("click",j),W.addEventListener("click",x),C.addEventListener("keydown",t=>{t.key==="Escape"?x():t.key==="Enter"&&t.ctrlKey&&(t.preventDefault(),j())});function H(t){const n=new Date(t),l={weekday:"short",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"};return n.toLocaleString("en-US",l)}function b(){const t=document.querySelector("#journal-entries-table tbody"),n=document.querySelector("#journal-entry-template"),l=document.querySelector(".main-container");t.innerHTML="";const i=r.getAllTasks().filter(c=>T.includes(c.id));i.length>0?(l.classList.add("show-journals"),i.forEach(c=>{const u=c.journals;if(u.length>0){const k=document.createElement("tr"),p=document.createElement("td");p.colSpan=2,p.innerHTML=`<strong>Task: ${c.name}</strong>`,k.appendChild(p),t.appendChild(k),u.sort((y,v)=>new Date(y.time).getTime()-new Date(v.time).getTime()),u.forEach(y=>{const v=n.content.cloneNode(!0),O=v.querySelector(".journal-time"),V=v.querySelector(".journal-content");O.textContent=H(y.time),V.textContent=y.content,t.appendChild(v)})}})):l.classList.remove("show-journals")}q(),I(),b()});
