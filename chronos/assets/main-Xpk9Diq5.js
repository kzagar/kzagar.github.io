(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))r(a);new MutationObserver(a=>{for(const o of a)if(o.type==="childList")for(const d of o.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&r(d)}).observe(document,{childList:!0,subtree:!0});function s(a){const o={};return a.integrity&&(o.integrity=a.integrity),a.referrerPolicy&&(o.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?o.credentials="include":a.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(a){if(a.ep)return;a.ep=!0;const o=s(a);fetch(a.href,o)}})();class S{constructor(e,s){this.start=e,this.end=s}static fromJSON(e){return new S(new Date(e.start),new Date(e.end))}toJSON(){return{start:this.start.toISOString(),end:this.end.toISOString()}}getDuration(){return(this.end.getTime()-this.start.getTime())/1e3}}class N{constructor(e,s=new Date().toISOString()){this.content=e,this.time=s}static fromJSON(e){return new N(e.content,e.time)}toJSON(){return{content:this.content,time:this.time}}}class D{constructor(e,s,r=0,a=[],o=[]){this.id=e,this.name=s,this.time=r,this.journals=a.map(d=>N.fromJSON(d)),this.intervals=o.map(d=>S.fromJSON(d)),this.totalIntervalTime=this.calculateTotalIntervalTime()}updateName(e){this.name=e}addJournal(e){const s=new N(e);return this.journals.push(s),s}addInterval(e,s){const r=new S(e,s);return this.intervals.push(r),this.totalIntervalTime+=r.getDuration(),r}updateInterval(e,s,r){if(e>=0&&e<this.intervals.length){const a=this.intervals[e];this.totalIntervalTime-=a.getDuration();const o=new S(s,r);return this.intervals[e]=o,this.totalIntervalTime+=o.getDuration(),!0}return!1}getIntervals(){return this.intervals}calculateTotalIntervalTime(){let e=0;return this.intervals.forEach(s=>{e+=s.getDuration()}),Math.floor(e)}static fromJSON(e){const s=new D(e.id,e.name,e.time,e.journals,e.intervals);return s.totalIntervalTime=s.calculateTotalIntervalTime(),s}toJSON(){return{id:this.id,name:this.name,time:this.time,journals:this.journals.map(e=>e.toJSON()),intervals:this.intervals.map(e=>e.toJSON())}}}class J{constructor(e=[],s=1){this.tasks=e.map(r=>D.fromJSON(r)),this.nextTaskId=s}addTask(e){const s=new D(this.nextTaskId++,e.trim());return this.tasks.unshift(s),s}deleteTask(e){return this.tasks.find(r=>r.id===e)?(this.tasks=this.tasks.filter(r=>r.id!==e),!0):!1}findTask(e){return this.tasks.find(s=>s.id===e)}updateTaskName(e,s){const r=this.findTask(e);return r?(r.updateName(s),!0):!1}addJournalEntry(e,s){const r=this.findTask(e);return r?(r.addJournal(s),!0):!1}getAllTasks(){return this.tasks}toJSON(){return{tasks:this.tasks.map(e=>e.toJSON()),nextTaskId:this.nextTaskId}}static fromJSON(e){return new J(e.tasks,e.nextTaskId)}}document.addEventListener("DOMContentLoaded",()=>{const u=document.querySelector("#task-table tbody"),e=document.querySelector("#task-row-template"),s=document.querySelector("#new-task-row .new-task-input");let r=new J,a=-1,o=null,d=null,f=[],I=null,k=[],m=null;function L(t){const n=Math.floor(t/3600),l=Math.floor(t%3600/60),i=t%60,c=g=>g.toString().padStart(2,"0");return n>0?`${n}:${c(l)}:${c(i)}`:`${l}:${c(i)}`}function q(){const t=localStorage.getItem("chronosTasks"),n=localStorage.getItem("chronosTaskOrder"),l=localStorage.getItem("chronosRunningTaskId"),i=localStorage.getItem("chronosTasksWithVisibleJournals");if(t?r=J.fromJSON(JSON.parse(t)):(r=new J,r.addTask("Task 1"),r.addTask("Task 2"),r.addTask("Task 3")),n?f=JSON.parse(n):f=r.getAllTasks().map(c=>c.id),l!==null){a=parseInt(l,10);const c=r.findTask(a);c?(o=new Date,d=setInterval(()=>{const g=o?(new Date().getTime()-o.getTime())/1e3:0,h=c.totalIntervalTime+g,p=document.querySelector(`tr[data-id='${c.id}'] .task-time`);p&&(p.textContent=L(Math.floor(h))),T()},1e3)):(a=-1,o=null)}i&&(k=JSON.parse(i))}function T(){localStorage.setItem("chronosTasks",JSON.stringify(r)),localStorage.setItem("chronosTaskOrder",JSON.stringify(f)),localStorage.setItem("chronosRunningTaskId",a.toString()),localStorage.setItem("chronosTasksWithVisibleJournals",JSON.stringify(k))}function w(){const t=document.getElementById("new-task-row");Array.from(u.children).forEach(n=>{n.id!=="new-task-row"&&n.remove()}),u.firstChild!==t&&t&&u.prepend(t);for(let n=f.length-1;n>=0;n--){const l=f[n],i=r.findTask(l);if(!i)continue;const c=e.content.cloneNode(!0),g=c.querySelector("tr");g.dataset.id=i.id.toString();const h=c.querySelector(".task-name");h.textContent=i.name,h.contentEditable="true",h.dataset.taskId=i.id.toString();const p=c.querySelector(".task-time"),v=i.totalIntervalTime+(i.id===a&&o?(new Date().getTime()-o.getTime())/1e3:0);p.textContent=L(Math.floor(v));const y=c.querySelector(".start-pause-btn");y.textContent=i.id===a?"❚❚":"▶";const O=c.querySelector(".show-journal-checkbox");O.checked=k.includes(i.id),O.dataset.taskId=i.id.toString(),t&&u.insertBefore(c,t.nextSibling)}}function B(t){const n=r.findTask(t);if(n){if(a===t)d&&(clearInterval(d),d=null),o&&(n.addInterval(o,new Date),o=null),a=-1;else{if(a!==-1){const l=r.findTask(a);l&&d&&(clearInterval(d),d=null,o&&(l.addInterval(o,new Date),o=null))}a=t,o=new Date,d=setInterval(()=>{const l=o?(new Date().getTime()-o.getTime())/1e3:0,i=n.totalIntervalTime+l,c=document.querySelector(`tr[data-id='${n.id}'] .task-time`);c&&(c.textContent=L(Math.floor(i))),T()},1e3)}T(),w()}}function M(t,n){r.updateTaskName(t,n)&&T()}function R(t){if(t.trim()==="")return;const n=r.addTask(t);f.unshift(n.id),T(),w(),s.textContent=""}function $(t){const n=r.findTask(t);n&&confirm(`Are you sure you want to delete "${n.name}"?`)&&r.deleteTask(t)&&(f=f.filter(l=>l!==t),a===t&&(d&&(clearInterval(d),d=null),o=null,a=-1),k=k.filter(l=>l!==t),T(),w(),b())}u.addEventListener("click",t=>{const n=t.target,l=n.closest("tr");if(!l)return;const i=parseInt(l.dataset.id,10);n.classList.contains("start-pause-btn")?B(i):n.classList.contains("journal-btn")?(I=i,P()):n.classList.contains("delete-btn")?$(i):n.classList.contains("show-journal-checkbox")&&(n.checked?k.includes(i)||k.push(i):k=k.filter(c=>c!==i),T(),b())}),u.addEventListener("keydown",t=>{if(t.target.classList.contains("task-name")){if(t.key==="Enter")t.preventDefault(),t.target.blur();else if(t.key==="Escape"){const n=r.findTask(parseInt(t.target.dataset.taskId));n&&(t.target.textContent=n.name),t.target.blur()}}else t.target.classList.contains("new-task-input")&&t.key==="Enter"&&(t.preventDefault(),R(t.target.textContent||""))}),u.addEventListener("blur",t=>{if(t.target.classList.contains("task-name")){const n=parseInt(t.target.dataset.taskId,10),l=(t.target.textContent||"").trim();M(n,l)}},!0),u.addEventListener("dragstart",t=>{t.target.tagName==="TR"&&t.target.id!=="new-task-row"&&(m=t.target,t.dataTransfer.effectAllowed="move",setTimeout(()=>{m&&(m.style.opacity="0.5")},0))}),u.addEventListener("dragover",t=>{if(t.preventDefault(),t.target&&t.target.closest("tr")&&t.target.closest("tr").id!=="new-task-row"&&m){const n=t.target.closest("tr");if(n!==m){const l=n.getBoundingClientRect(),i=l.y+l.height/2;t.clientY>i?(n.style.borderBottom="2px solid blue",n.style.borderTop=""):(n.style.borderTop="2px solid blue",n.style.borderBottom="")}}}),u.addEventListener("dragleave",t=>{t.target&&t.target.closest("tr")&&(t.target.closest("tr").style.borderTop="",t.target.closest("tr").style.borderBottom="")}),u.addEventListener("drop",t=>{if(t.preventDefault(),t.target&&t.target.closest("tr")&&t.target.closest("tr").id!=="new-task-row"&&m){const n=t.target.closest("tr"),l=parseInt(n.dataset.id,10),i=parseInt(m.dataset.id,10),c=f.indexOf(i),g=f.indexOf(l);c!==-1&&g!==-1&&(f.splice(c,1),f.splice(g,0,i),T()),w()}m&&(m.style.opacity=""),t.target&&t.target.closest("tr")&&(t.target.closest("tr").style.borderTop="",t.target.closest("tr").style.borderBottom="")}),u.addEventListener("dragend",t=>{m&&(m.style.opacity=""),u.querySelectorAll("tr").forEach(n=>{n.style.borderTop="",n.style.borderBottom=""}),m=null}),"serviceWorker"in navigator&&window.addEventListener("load",()=>{navigator.serviceWorker.register("sw.js").then(t=>{console.log("Service Worker registered: ",t)}).catch(t=>{console.log("Service Worker registration failed: ",t)})});const C=document.getElementById("journal-dialog"),E=document.getElementById("journal-input"),A=document.getElementById("add-journal-btn"),W=document.getElementById("discard-journal-btn");function P(){C.style.display="flex",E.value="",E.focus()}function x(){C.style.display="none",E.value="",I=null}function j(){const t=E.value.trim();if(t===""){alert("Journal entry cannot be empty.");return}if(I===null){alert("No task selected for journal entry.");return}if(r.addJournalEntry(I,t)){T(),x();const n=r.findTask(I);console.log("Journal Entries for Task:",n?n.journals:"Task not found"),b()}else alert("Selected task not found.")}A.addEventListener("click",j),W.addEventListener("click",x),C.addEventListener("keydown",t=>{t.key==="Escape"?x():t.key==="Enter"&&t.ctrlKey&&(t.preventDefault(),j())});function H(t){const n=new Date(t),l={weekday:"short",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"};return n.toLocaleString("en-US",l)}function b(){const t=document.querySelector("#journal-entries-table tbody"),n=document.querySelector("#journal-entry-template"),l=document.querySelector(".main-container");t.innerHTML="";const i=r.getAllTasks().filter(c=>k.includes(c.id));i.length>0?(l.classList.add("show-journals"),i.forEach(c=>{const g=c.journals;if(g.length>0){const h=document.createElement("tr"),p=document.createElement("td");p.colSpan=2,p.innerHTML=`<strong>Task: ${c.name}</strong>`,h.appendChild(p),t.appendChild(h),g.sort((v,y)=>new Date(v.time).getTime()-new Date(y.time).getTime()),g.forEach(v=>{const y=n.content.cloneNode(!0),O=y.querySelector(".journal-time"),V=y.querySelector(".journal-content");O.textContent=H(v.time),V.textContent=v.content,t.appendChild(y)})}})):l.classList.remove("show-journals")}q(),w(),b()});
